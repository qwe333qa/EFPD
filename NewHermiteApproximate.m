function z=NewHermiteApproximate(self,x)
    e=self.ecount;
    ntotal=length(e)-1;
    coef=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
          0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
          -1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
          0,-3,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
          3,0,-6,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
          0,15,0,-10,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
          -15,0,45,0,-15,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0
          0,-105,0,105,0,-21,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
          105,0,-420,0,210,0,-28,0,1,0,0,0,0,0,0,0,0,0,0,0,0
          0,945,0,-1260,0,378,0,-36,0,1,0,0,0,0,0,0,0,0,0,0,0
          -945,0,4725,0,-3150,0,630,0,-45,0,1,0,0,0,0,0,0,0,0,0,0
          0,-10395,0,17325,0,-6930,0,990,0,-55,0,1,0,0,0,0,0,0,0,0,0
          10395,0,-62370,0,51975,0,-13860,0,1485,0,-66,0,1,0,0,0,0,0,0,0,0
          0,135135,0,-270270,0,135135,0,-25740,0,2145,0,-78,0,1,0,0,0,0,0,0,0
          -135135,0,945945,0,-945945,0,315315,0,-45045,0,3003,0,-91,0,1,0,0,0,0,0,0
          0,-2027025,0,4729725,0,-2837835,0,675675,0,-75075,0,4095,0,-105,0,1,0,0,0,0,0
          2027025,0,-16216200,0,18918900,0,-7567560,0,1351350,0,-120120,0,5460,0,-120,0,1,0,0,0,0
          0,34459425,0,-91891800,0,64324260,0,-18378360,0,2552550,0,-185640,0,7140,0,-136,0,1,0,0,0
          -34459425,0,310134825,0,-413513100,0,192972780,0,-41351310,0,4594590,0,-278460,0,9180,0,-153,0,1,0,0
          0,-654729075,0,1964187225,0,-1571349780,0,523783260,0,-87297210,0,7936110,0,-406980,0,11628,0,-171,0,1,0
          654729075,0,-6547290750,0,9820936125,0,-5237832600,0,1309458150,0,-174594420,0,13226850,0,-581400,0,14535,0,-190,0,1];
    coef=coef(1:(ntotal+1),1:(ntotal+1));
    e=e(1:(ntotal+1));
    m=e(2);
    s=sqrt(e(3)-e(2)^2);
    e=Normalize(e);
    x=(x-m)/s;
    xs=XiShu(e,coef);
    hx=H(x,coef,ntotal);
    xs=xs(:)';
    z=xs*hx;
    phi=exp(-x.^2/2)/sqrt(2*pi);
    phi=phi(:)';
    z=z.*phi;
    z=z/s;
    z=(z>=0).*z;
end

function z=Normalize(e)
    n=length(e);
    n=1000.^(0:(n-1));
    e=e./n;
    m=e(2);
    s=sqrt(e(3)-e(2)^2);
    z=zeros(1,length(e));
    for i=4:length(e)
        for k=0:(i-1)
            z(i)=z(i)+nchoosek(i-1,k)*e(i-k)*(-m)^k;
        end
        z(i)=z(i)/s^(i-1);
    end
    z(1)=1;
    z(2)=0;
    z(3)=1;
end

function z=XiShu(e,coef)
    ntotal=length(e);
    coef=coef(1:ntotal,1:ntotal);
    e=e(:);
    z=coef*e;
    z=z./factorial(0:(ntotal-1))';
end

function z=H(x,coef,ntotal)
    coef=coef(1:(ntotal+1),1:(ntotal+1));
    xd=ones(ntotal+1,length(x))*diag(x);
    p=diag(0:ntotal)*ones(ntotal+1,length(x));
    xd=xd.^p;
    z=coef*xd;
end
